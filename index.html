<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <!--Facebook-->
    <meta property="og:url"           content="https://00e9e64bac6e0ec6b116b790b7b7740b85eaa1194fa9d01490-apidata.googleusercontent.com/download/storage/v1/b/testing-bucket-gcp/o/1541659133827Screenshot%20from%202018-11-05%2013-18-32.png?qk=AD5uMEt6oSsAG0HPLb5ue7VV-s8Whhw8nfQlQ3nP9QGcm96rurGZjTii1oCBQFd_dTdKaxdFFZ6bFnAh5dAWzJ2UbcSHoLDUGNzCGkxa60pGcNxBOvd-LM2fu0JRpV78p_gPXPLmNC8yfHvRWb-vr3rf1ElPb9CQmgdRPAGkUprsEp18_lfoOka47l0nybTlB6ryN1U0wL0nX9i0OkOqhcL-tikokOx4qkyIsvbPRd9eRGZLuQpzJF4-8sTEWomc-eUrtSDPPNkBaCYBFNiYghYq7P2t2eAXeVeCorqJBBXI7ZODQ950XVc1Ob7-PliPF0LLrHZuTJBgQglK6Necp4k_SmkOC7BsWy7XEpZIXVYtPVsV4HKB_f9GD87ZKoyAA0o7Ioc_5cIDqgpGXBEy-8Jgt_SvDl1gUlOzOpIjS8vQhsTaOdv79Bhesii47GaWRNY3VdmYIOfhgFX4ziYwe2N9W2VUUJRV7f2Jkue_6JvsNGemqIA_Q6LhpUObiPPqcDsbJLRg7ma78PT6guy26F4253sfqqclX3E-W3gLylPowVEali0qGUNtFo8wrRhldjZVCB7rsTizBulvUAF_aY1Up9PxHIDlzbtThHzSruPNo4gZ-Rm-YKP9VXxqvLRNZgiAXRBjNiZVf4WcUttzyU6c5U_-Czjr6ChAbuUkjwy55KLMCyhuoYfMkSlyrWHEC4RV8ly3EeQ0qBZecCx6FfPcOUmgFz1fyxpSFfDv5ybne04UQmP0p5uE14e9XdEJiYKnI3E-DgjQUu-VSXme5uE8aopuytuVe4YkZ-K_0UC8cziSt0FtLbw9Q9gTZySxdefWLVd0DPRxUJav-hoI95dStzyRAgJY3A" />
    <meta property="og:type"          content="Website" />
    <meta property="og:title"         content="Eden app" />
    <meta property="og:description"   content="Description" />
    <meta property="og:image"         content="https://00e9e64bac6e0ec6b116b790b7b7740b85eaa1194fa9d01490-apidata.googleusercontent.com/download/storage/v1/b/testing-bucket-gcp/o/1541659133827Screenshot%20from%202018-11-05%2013-18-32.png?qk=AD5uMEt6oSsAG0HPLb5ue7VV-s8Whhw8nfQlQ3nP9QGcm96rurGZjTii1oCBQFd_dTdKaxdFFZ6bFnAh5dAWzJ2UbcSHoLDUGNzCGkxa60pGcNxBOvd-LM2fu0JRpV78p_gPXPLmNC8yfHvRWb-vr3rf1ElPb9CQmgdRPAGkUprsEp18_lfoOka47l0nybTlB6ryN1U0wL0nX9i0OkOqhcL-tikokOx4qkyIsvbPRd9eRGZLuQpzJF4-8sTEWomc-eUrtSDPPNkBaCYBFNiYghYq7P2t2eAXeVeCorqJBBXI7ZODQ950XVc1Ob7-PliPF0LLrHZuTJBgQglK6Necp4k_SmkOC7BsWy7XEpZIXVYtPVsV4HKB_f9GD87ZKoyAA0o7Ioc_5cIDqgpGXBEy-8Jgt_SvDl1gUlOzOpIjS8vQhsTaOdv79Bhesii47GaWRNY3VdmYIOfhgFX4ziYwe2N9W2VUUJRV7f2Jkue_6JvsNGemqIA_Q6LhpUObiPPqcDsbJLRg7ma78PT6guy26F4253sfqqclX3E-W3gLylPowVEali0qGUNtFo8wrRhldjZVCB7rsTizBulvUAF_aY1Up9PxHIDlzbtThHzSruPNo4gZ-Rm-YKP9VXxqvLRNZgiAXRBjNiZVf4WcUttzyU6c5U_-Czjr6ChAbuUkjwy55KLMCyhuoYfMkSlyrWHEC4RV8ly3EeQ0qBZecCx6FfPcOUmgFz1fyxpSFfDv5ybne04UQmP0p5uE14e9XdEJiYKnI3E-DgjQUu-VSXme5uE8aopuytuVe4YkZ-K_0UC8cziSt0FtLbw9Q9gTZySxdefWLVd0DPRxUJav-hoI95dStzyRAgJY3A" />

    <title>Sotosop</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/3-col-portfolio.css" rel="stylesheet">

  </head>

  <body>

    <!-- Load Facebook SDK for JavaScript -->
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = 'https://connect.facebook.net/id_ID/sdk.js#xfbml=1&version=v3.2&appId=649948822073391&autoLogAppEvents=1';
      fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));
    </script>

    <div id="app">
      <!-- Navigation -->
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="#">Sotosop</a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>
      </nav>        

      <!-- Page Content -->
      <div class="container">
        
        <!-- Page Heading -->
        <h1 class="my-4">SotoSop:
          <small>Art Unleashed</small>
        </h1>
        <input type="search" placeholder="Search" v-model='searchText'>
        <button v-on:click="search()" type="button" class="btn btn-outline-success my-2 my-sm-0 btn-sm">Search</button>
        <br><br>

        <!--Form-->
        <form>
          <div class="row mb-5">
            <div class="col-6 border">
                <button type="button" class="btn btn-primary" v-on:click="uploadJson()">Primary</button>
            </div>
            <div class="col-6 border">
              <div class="form-group">
                  <input class="form-control" type="file" accept="image/*" @change="processFile($event)">
              </div>
              <div class="form-group">
                  <input class="form-control" type="text" placeholder="Name" v-model=upload_name>
               </div>
               <div class="form-group">
                  <input type="text" class="form-control" placeholder="Title" v-model=upload_title>
               </div>
               <div class="form-group">
                  <button type="button" v-on:click="upload()">Upload</button>
                </div>
            </div>
          </div>
      </form>


        <div v-if="error" id="error" class="alert alert-danger alert-dismissible fade show" role="alert">
            {{error_message}}
        </div>

        <div class="row">
         <my-image v-for="image in images" v-bind:url="image.image" v-bind:name="image.name" v-bind:title="image.title"></my-image>
        </div>
        <!-- /.row -->
        
      </div>
      <!-- /.container -->

      <!-- Footer -->
      <footer class="py-5 bg-dark">
        <div class="container">
          <p class="m-0 text-center text-white">Copyright &copy; SotoSop 2018</p>
        </div>
        <!-- /.container -->
      </footer>
    </div>
    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!--Axios-->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!--Vue-->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <!--Vue-->
    <script>
      Vue.component('my-image',{
        props :['url','name', 'title'],
        template : ` <div class="col-lg-4 col-sm-6 portfolio-item">
            <div class="card h-100">
              <img class="card-img-top" v-bind:src="url" alt="Image">
              <div class="card-body">
                <h4 class="card-title">
                 {{ title }}
                </h4>
                <p class="card-text">{{ name }}</p>
                <div class="fb-share-button" v-bind:data-href="url"
                  data-layout="button_count"
                  data-size="large" data-mobile-iframe="true">
                  <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2F127.0.0.1%3A8080%2F&amp;src=sdkpreparse" class="fb-xfbml-parse-ignore">Share</a>
                </div>
              </div>
            </div>
          </div>`
      })
      new Vue ({
        el: "#app",
        data: {
          images: [],
          searchText: "",
          error: false,
          error_message: "",
          file: null,
          upload_name: "",
          upload_title: "",

          
        },
        methods: {
          search: function() {
            axios({
                    method:"get",
                    url: `http://localhost:3000/search?search=${this.searchText}`
                })
                .then((response) => {
                  let imageFound = response.data.data
                  if( imageFound){
                     this.images = imageFound
                  }                 
                  this.error = false
                  console.log('****',response)
                })
                .catch( error => {
                  console.log( error.response)
                  this.error_message = error.response.data.message
                  this.error = true
                })
          },
          processFile: function(event) {
            let image = event.traget.files[0]
            this.file=image
          },
          upload: function() {
            let formData = new FormData()
            formData.append('img', this.file)
            formData.append('title', this.title)
            formData.append('name', this.name)

            axios.post('http://localhost:3000/add-photo', formData, {
                headers:{
                    'Content-Type': 'multiform/form-data'
                }
            })
            .then( response => {
                console.log( response )
                this.getData()
            })
            .catch( error => {
                console.log(error.response.data )
            })
          },
          getData: function() {
            axios({
                    method:"get",
                    url: "http://localhost:3000/"
                })
                .then((response) => {
                    console.log(response)
                    let data = response.data.data
                    data.forEach((element, index) => {
                        this.images.push(element)
                    });
                    console.log(this.images)
                })
                .catch((err) => {
                    console.log(err.response.data)
                })
          },
          uploadJson : function(){
            axios({
              method : 'POST',
              url : 'http://localhost:3000/add',
              data : {
                  img : this.file, title : this.title, name : this.name
              }
            })
            .then( response => {
                console.log( response )
                this.getData()
            })
            .catch( error => {
                console.log(error.response.data )
            })
          }
        },
        created: function() {
                this.getData() 
            }
        })
     
    </script> 
  </body>

</html>
